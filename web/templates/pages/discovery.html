<!-- web/templates/pages/discovery.html -->
<div class="page-header">
    <h1 class="page-title">Network Discovery</h1>
    <p class="page-subtitle">Discover and identify industrial control system devices on your network</p>
</div>

<!-- Tabs -->
<div class="tabs">
    <div class="tab active" onclick="switchTab('scan')">
        <i class="fas fa-radar"></i> New Scan
    </div>
    <div class="tab" onclick="switchTab('results')">
        <i class="fas fa-search"></i> Recent Results
    </div>
    <div class="tab" onclick="switchTab('history')">
        <i class="fas fa-history"></i> Scan History
    </div>
</div>

<!-- New Scan Tab -->
<div id="scanTab" class="tab-content active">
    <!-- Discovery Setup -->
    <div class="discovery-card">
        <div class="card-header">
            <h2 class="card-title">Configure Network Scan</h2>
        </div>
        
        <form id="scanForm">
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">IP Range / Subnet</label>
                    <input type="text" class="form-input" id="ipRange" placeholder="192.168.1.0/24" required>
                    <span class="form-hint">Enter IP range or CIDR notation</span>
                </div>
                <div class="form-group">
                    <label class="form-label">Scan Type</label>
                    <select class="form-input" id="scanType">
                        <option value="quick">Quick Scan (Common Ports)</option>
                        <option value="full">Full Scan (All Ports)</option>
                        <option value="custom">Custom Port Range</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Timeout (seconds)</label>
                    <input type="number" class="form-input" id="timeout" value="30" min="10" max="300">
                    <span class="form-hint">Connection timeout per device</span>
                </div>
                <div class="form-group">
                    <label class="form-label">Max Concurrent Scans</label>
                    <input type="number" class="form-input" id="concurrent" value="50" min="1" max="100">
                    <span class="form-hint">Number of parallel scans</span>
                </div>
            </div>

            <div class="form-group" style="margin-top: 24px;">
                <label class="form-label">Select Protocols to Scan</label>
                <div class="protocol-grid">
                    <div class="protocol-card selected" onclick="toggleProtocol(this)">
                        <input type="checkbox" name="protocols" value="modbus" checked>
                        <div class="protocol-icon">
                            <i class="fas fa-microchip"></i>
                        </div>
                        <div class="protocol-name">Modbus</div>
                        <div class="protocol-port">Port 502</div>
                    </div>
                    <div class="protocol-card selected" onclick="toggleProtocol(this)">
                        <input type="checkbox" name="protocols" value="dnp3" checked>
                        <div class="protocol-icon">
                            <i class="fas fa-broadcast-tower"></i>
                        </div>
                        <div class="protocol-name">DNP3</div>
                        <div class="protocol-port">Port 20000</div>
                    </div>
                    <div class="protocol-card" onclick="toggleProtocol(this)">
                        <input type="checkbox" name="protocols" value="ethernet_ip">
                        <div class="protocol-icon">
                            <i class="fas fa-ethernet"></i>
                        </div>
                        <div class="protocol-name">EtherNet/IP</div>
                        <div class="protocol-port">Port 44818</div>
                    </div>
                    <div class="protocol-card" onclick="toggleProtocol(this)">
                        <input type="checkbox" name="protocols" value="bacnet">
                        <div class="protocol-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="protocol-name">BACnet</div>
                        <div class="protocol-port">Port 47808</div>
                    </div>
                    <div class="protocol-card" onclick="toggleProtocol(this)">
                        <input type="checkbox" name="protocols" value="s7">
                        <div class="protocol-icon">
                            <i class="fas fa-industry"></i>
                        </div>
                        <div class="protocol-name">S7 (Siemens)</div>
                        <div class="protocol-port">Port 102</div>
                    </div>
                    <div class="protocol-card" onclick="toggleProtocol(this)">
                        <input type="checkbox" name="protocols" value="snmp">
                        <div class="protocol-icon">
                            <i class="fas fa-network-wired"></i>
                        </div>
                        <div class="protocol-name">SNMP</div>
                        <div class="protocol-port">Port 161</div>
                    </div>
                </div>
            </div>

            <div style="display: flex; gap: 12px; margin-top: 24px;">
                <button type="submit" class="btn btn-primary" style="flex: 1;">
                    <i class="fas fa-play"></i> Start Scan
                </button>
                <button type="button" class="btn btn-secondary" onclick="resetForm()">
                    <i class="fas fa-redo"></i> Reset
                </button>
            </div>
        </form>
    </div>

    <!-- Scan Progress -->
    <div class="scan-progress" id="scanProgress">
        <div class="progress-header">
            <h3 class="progress-title">
                <div class="scanning-animation">
                    <span>Scanning Network</span>
                    <div class="scanning-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </h3>
            <button class="btn btn-danger" onclick="stopScan()">
                <i class="fas fa-stop"></i> Stop Scan
            </button>
        </div>
        
        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <div style="display: flex; justify-content: space-between; font-size: 14px; color: var(--text-secondary);">
            <span id="progressText">0%</span>
            <span id="progressTime">Elapsed: 0:00</span>
        </div>

        <div class="progress-stats">
            <div class="progress-stat">
                <div class="progress-stat-value" id="devicesFound">0</div>
                <div class="progress-stat-label">Devices Found</div>
            </div>
            <div class="progress-stat">
                <div class="progress-stat-value" id="ipsScanned">0</div>
                <div class="progress-stat-label">IPs Scanned</div>
            </div>
            <div class="progress-stat">
                <div class="progress-stat-value" id="protocolsDetected">0</div>
                <div class="progress-stat-label">Protocols Detected</div>
            </div>
            <div class="progress-stat">
                <div class="progress-stat-value" id="errorsCount">0</div>
                <div class="progress-stat-label">Errors</div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Results Tab -->
<div id="resultsTab" class="tab-content">
    <div class="results-section">
        <div class="results-header">
            <h2 class="results-title">Discovered Devices</h2>
            <div class="results-actions">
                <button class="btn btn-secondary">
                    <i class="fas fa-filter"></i> Filter
                </button>
                <button class="btn btn-primary">
                    <i class="fas fa-plus"></i> Add All to Inventory
                </button>
            </div>
        </div>

        <div class="device-grid" id="discoveredDevices">
            <!-- Sample discovered device -->
            <div class="device-card">
                <div class="device-header">
                    <div class="device-info">
                        <div class="device-name">Unknown PLC Device</div>
                        <div class="device-ip">192.168.1.101</div>
                    </div>
                    <div class="device-status new">New</div>
                </div>
                <div class="device-details">
                    <div class="device-detail">
                        <div class="device-detail-label">Protocol</div>
                        <div class="device-detail-value">Modbus TCP</div>
                    </div>
                    <div class="device-detail">
                        <div class="device-detail-label">Port</div>
                        <div class="device-detail-value">502</div>
                    </div>
                    <div class="device-detail">
                        <div class="device-detail-label">Vendor</div>
                        <div class="device-detail-value">Siemens</div>
                    </div>
                    <div class="device-detail">
                        <div class="device-detail-label">Response Time</div>
                        <div class="device-detail-value">12ms</div>
                    </div>
                </div>
                <div class="device-actions">
                    <button class="btn btn-secondary">
                        <i class="fas fa-info-circle"></i> Details
                    </button>
                    <button class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add to Inventory
                    </button>
                </div>
            </div>

            <!-- Empty state -->
            <div class="empty-state" style="grid-column: 1 / -1; display: none;">
                <i class="fas fa-search"></i>
                <div class="empty-state-title">No Recent Results</div>
                <div class="empty-state-text">Run a network scan to discover devices</div>
                <button class="btn btn-primary" onclick="switchTab('scan')">
                    <i class="fas fa-radar"></i> Start New Scan
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Scan History Tab -->
<div id="historyTab" class="tab-content">
    <div class="history-table">
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Scan Date</th>
                        <th>Type</th>
                        <th>Target</th>
                        <th>Duration</th>
                        <th>Devices Found</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="scanHistoryBody">
                    <tr>
                        <td>2024-01-20 14:30:00</td>
                        <td><span class="scan-type-badge network">Network</span></td>
                        <td>192.168.1.0/24</td>
                        <td>2m 45s</td>
                        <td>23</td>
                        <td><span class="scan-status completed"><i class="fas fa-check-circle"></i> Completed</span></td>
                        <td>
                            <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">
                                <i class="fas fa-eye"></i> View
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td>2024-01-20 10:15:00</td>
                        <td><span class="scan-type-badge protocol">Protocol</span></td>
                        <td>Modbus Devices</td>
                        <td>1m 20s</td>
                        <td>8</td>
                        <td><span class="scan-status completed"><i class="fas fa-check-circle"></i> Completed</span></td>
                        <td>
                            <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">
                                <i class="fas fa-eye"></i> View
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>