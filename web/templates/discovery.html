<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICS Asset Inventory - Network Discovery</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Root Variables - Same as Dashboard */
        :root {
            --primary-color: #0EA5E9;
            --primary-dark: #0284C7;
            --secondary-color: #06B6D4;
            --success-color: #10B981;
            --warning-color: #F59E0B;
            --danger-color: #EF4444;
            --info-color: #3B82F6;
            
            --bg-primary: #F8FAFC;
            --bg-secondary: #FFFFFF;
            --bg-tertiary: #F1F5F9;
            
            --text-primary: #1E293B;
            --text-secondary: #64748B;
            --text-tertiary: #94A3B8;
            
            --border-color: #E2E8F0;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Layout Container */
        .app-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar - Reuse from Dashboard */
        .sidebar {
            width: 280px;
            background-color: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .logo i {
            font-size: 28px;
        }

        .nav-menu {
            flex: 1;
            padding: 16px 12px;
            overflow-y: auto;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            margin-bottom: 4px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--radius-md);
            transition: all 0.2s ease;
            font-size: 15px;
        }

        .nav-item:hover {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .nav-item.active {
            background-color: #DBEAFE;
            color: var(--primary-color);
            font-weight: 600;
        }

        .nav-item i {
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Top Bar */
        .topbar {
            background-color: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-header {
            flex: 1;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .page-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
        }

        /* User Profile */
        .user-profile {
            display: flex;
            align-items: center;
            gap: 0;
        }

        .notifications {
            position: relative;
            cursor: pointer;
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            background-color: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 18px;
            transition: all 0.2s ease;
        }

        .notification-icon:hover {
            color: var(--text-primary);
            background-color: var(--bg-primary);
        }

        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 20px;
            height: 20px;
            background-color: var(--danger-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .user-menu:hover {
            background-color: var(--bg-tertiary);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .user-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .user-role {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        /* Content Area */
        .content {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
        }

        /* Discovery Setup Card */
        .discovery-card {
            background-color: var(--bg-secondary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            padding: 24px;
            margin-bottom: 24px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: var(--bg-secondary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #DC2626;
        }

        /* Form Elements */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-input {
            padding: 10px 14px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 14px;
            color: var(--text-primary);
            background-color: var(--bg-secondary);
            outline: none;
            transition: all 0.2s ease;
        }

        .form-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }

        .form-hint {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        /* Protocol Selection */
        .protocol-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .protocol-card {
            padding: 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .protocol-card:hover {
            border-color: var(--primary-color);
            background-color: var(--bg-tertiary);
        }

        .protocol-card.selected {
            border-color: var(--primary-color);
            background-color: #DBEAFE;
        }

        .protocol-card input[type="checkbox"] {
            position: absolute;
            top: 12px;
            right: 12px;
        }

        .protocol-icon {
            font-size: 32px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .protocol-card.selected .protocol-icon {
            color: var(--primary-color);
        }

        .protocol-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .protocol-port {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        /* Scan Progress */
        .scan-progress {
            background-color: var(--bg-secondary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            padding: 24px;
            margin-bottom: 24px;
            display: none;
        }

        .scan-progress.active {
            display: block;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .progress-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .progress-bar-container {
            background-color: var(--bg-tertiary);
            height: 8px;
            border-radius: 999px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 999px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .progress-stat {
            text-align: center;
            padding: 16px;
            background-color: var(--bg-tertiary);
            border-radius: var(--radius-md);
        }

        .progress-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .progress-stat-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Scan Results */
        .results-section {
            margin-top: 32px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .results-actions {
            display: flex;
            gap: 12px;
        }

        /* Discovered Devices */
        .device-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .device-card {
            background-color: var(--bg-secondary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            padding: 20px;
            transition: all 0.3s ease;
        }

        .device-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .device-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }

        .device-info {
            flex: 1;
        }

        .device-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .device-ip {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .device-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 500;
        }

        .device-status.new {
            background-color: #DBEAFE;
            color: #1E40AF;
        }

        .device-status.existing {
            background-color: #F3F4F6;
            color: #374151;
        }

        .device-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .device-detail {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .device-detail-label {
            font-size: 12px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .device-detail-value {
            font-size: 14px;
            color: var(--text-primary);
        }

        .device-actions {
            display: flex;
            gap: 8px;
        }

        .device-actions button {
            flex: 1;
        }

        /* Scan History */
        .history-table {
            background-color: var(--bg-secondary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .table-container {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: left;
            padding: 12px 24px;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-tertiary);
            background-color: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
        }

        .data-table td {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .data-table tr:hover {
            background-color: var(--bg-tertiary);
        }

        .scan-type-badge {
            padding: 4px 12px;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
        }

        .scan-type-badge.quick {
            background-color: #DBEAFE;
            color: #1E40AF;
        }

        .scan-type-badge.full {
            background-color: #D1FAE5;
            color: #065F46;
        }

        .scan-type-badge.custom {
            background-color: #FEE2E2;
            color: #991B1B;
        }

        .scan-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .scan-status.completed {
            color: var(--success-color);
        }

        .scan-status.running {
            color: var(--warning-color);
        }

        .scan-status.failed {
            color: var(--danger-color);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-tertiary);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .empty-state-text {
            font-size: 14px;
            margin-bottom: 20px;
        }

        /* Loading Animation */
        .scanning-animation {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--primary-color);
        }

        .scanning-dots {
            display: flex;
            gap: 4px;
        }

        .scanning-dots span {
            width: 8px;
            height: 8px;
            background-color: var(--primary-color);
            border-radius: 50%;
            animation: pulse 1.4s infinite ease-in-out both;
        }

        .scanning-dots span:nth-child(1) {
            animation-delay: -0.32s;
        }

        .scanning-dots span:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes pulse {
            0%, 80%, 100% {
                transform: scale(0);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 24px;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 32px;
        }

        .tab {
            padding: 12px 0;
            font-size: 15px;
            font-weight: 500;
            color: var(--text-secondary);
            text-decoration: none;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .tab:hover {
            color: var(--text-primary);
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 9999;
            animation: slideIn 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 400px;
            font-size: 14px;
            font-weight: 500;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                position: absolute;
                left: -280px;
                height: 100%;
                z-index: 1000;
                box-shadow: var(--shadow-lg);
            }

            .sidebar.active {
                left: 0;
            }

            .device-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .protocol-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .user-info {
                display: none;
            }
        }

        /* Logout button styling */
        .nav-item.logout {
            margin-top: auto;
            color: var(--danger-color);
            border-top: 1px solid var(--border-color);
            padding-top: 16px;
            margin-top: 16px;
        }

        .nav-item.logout:hover {
            background-color: #FEE2E2;
            color: var(--danger-color);
        }

        /* Dropdown Menu */
        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            min-width: 200px;
            display: none;
            z-index: 100;
        }

        .dropdown-menu.active {
            display: block;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 16px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .dropdown-item:hover {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .dropdown-divider {
            height: 1px;
            background-color: var(--border-color);
            margin: 8px 0;
        }

        .user-menu-container {
            position: relative;
        }

        /* Passive Scanning Styles - ADD THESE */
        .scan-mode-indicator {
            background-color: #DBEAFE;
            border: 1px solid #60A5FA;
            border-radius: var(--radius-md);
            padding: 12px 16px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #1E40AF;
            font-size: 14px;
        }

        .scan-mode-indicator i {
            font-size: 20px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.4; }
            50% { opacity: 1; }
            100% { opacity: 0.4; }
        }

        .passive-stats {
            margin-left: auto;
            display: flex;
            gap: 20px;
            font-size: 13px;
        }

        .passive-stats strong {
            color: #1E40AF;
            font-weight: 600;
        }

        /* Protocol Enhancement Indicator */
        .protocol-enhancement {
            background-color: #F0FDF4;
            border: 1px solid #86EFAC;
            border-radius: var(--radius-sm);
            padding: 8px 12px;
            margin-top: 12px;
            font-size: 12px;
            color: #166534;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .protocol-enhancement i {
            color: #22C55E;
        }

        /* Auto-classified indicator */
        .auto-classified {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            background-color: #FEF3C7;
            color: #92400E;
            border-radius: var(--radius-sm);
            font-size: 11px;
            font-weight: 500;
            margin-left: 8px;
        }

        .auto-classified i {
            font-size: 10px;
        }

        /* Enhanced device card for better classification display */
        .device-classification {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed var(--border-color);
        }

        .classification-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background-color: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            font-size: 12px;
            color: var(--text-secondary);
        }

        .classification-badge i {
            font-size: 12px;
            color: var(--primary-color);
        }

        /* Network interface selector for passive mode */
        .network-interface-group {
            display: none;
            margin-top: 16px;
            padding: 16px;
            background-color: var(--bg-tertiary);
            border-radius: var(--radius-md);
        }

        .network-interface-group.visible {
            display: block;
        }

        .interface-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 8px;
            margin-top: 12px;
        }

        .interface-item {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .interface-item:hover {
            border-color: var(--primary-color);
            background-color: var(--bg-secondary);
        }

        .interface-item.selected {
            background-color: #DBEAFE;
            border-color: var(--primary-color);
            color: #1E40AF;
        }

        .interface-name {
            font-weight: 500;
            font-size: 14px;
        }

        .interface-ip {
            font-size: 12px;
            color: var(--text-tertiary);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-network-wired"></i>
                    <span>ICS Inventory</span>
                </div>
            </div>
            <nav class="nav-menu">
                <a href="/" class="nav-item">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </a>
                <a href="/assets" class="nav-item">
                    <i class="fas fa-cube"></i>
                    Assets
                </a>
                <a href="/discovery" class="nav-item active">
                    <i class="fas fa-search-location"></i>
                    Discovery
                </a>
                <a href="/security" class="nav-item">
                    <i class="fas fa-shield-alt"></i>
                    Security
                </a>
                <a href="/reports" class="nav-item">
                    <i class="fas fa-chart-line"></i>
                    Reports
                </a>
                <a href="/settings" class="nav-item">
                    <i class="fas fa-cog"></i>
                    Settings
                </a>
                <a href="#" class="nav-item logout" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <header class="topbar">
                <div class="page-header">
                    <h1 class="page-title">Network Discovery</h1>
                    <p class="page-subtitle">Discover and identify industrial control system devices on your network</p>
                </div>
                
                <!-- User Profile Section -->
                <div class="user-profile" id="userProfileContainer">
                    <!-- Profile will be injected here by user-profile.js -->
                </div>
            </header>

            <!-- Content Area -->
            <div class="content">
                <!-- Tabs -->
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('scan')">
                        <i class="fas fa-radar"></i> New Scan
                    </div>
                    <div class="tab" onclick="switchTab('results')">
                        <i class="fas fa-search"></i> Recent Results
                    </div>
                    <div class="tab" onclick="switchTab('history')">
                        <i class="fas fa-history"></i> Scan History
                    </div>
                </div>

                <!-- New Scan Tab -->
                <div id="scanTab" class="tab-content active">
                    <!-- Discovery Setup -->
                    <div class="discovery-card">
                        <div class="card-header">
                            <h2 class="card-title">Configure Network Scan</h2>
                        </div>
                        
                        <form id="scanForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">IP Range / Subnet</label>
                                    <input type="text" class="form-input" id="ipRange" name="ipRange" placeholder="192.168.1.0/24" required>
                                    <span class="form-hint">Enter IP range or CIDR notation</span>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Scan Type</label>
                                    <select class="form-input" id="scanType" name="scanType">
                                        <option value="quick">Quick Scan (Common Ports)</option>
                                        <option value="full">Full Scan (All Ports)</option>
                                        <option value="custom">Custom Port Range</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Scan Mode</label>
                                    <select class="form-input" id="scanMode" name="scanMode" onchange="handleScanModeChange()">
                                        <option value="active">Active Scan (Traditional)</option>
                                        <option value="passive">Passive Monitoring Only</option>
                                        <option value="hybrid">Hybrid (Active + Passive)</option>
                                    </select>
                                    <span class="form-hint">
                                        <i class="fas fa-info-circle"></i> Passive mode monitors network traffic without sending packets
                                    </span>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Timeout (seconds)</label>
                                    <input type="number" class="form-input" id="timeout" name="timeout" value="30" min="10" max="300">
                                    <span class="form-hint">Connection timeout per device</span>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Max Concurrent Scans</label>
                                    <input type="number" class="form-input" id="concurrent" name="concurrent" value="50" min="1" max="100">
                                    <span class="form-hint">Number of parallel scans</span>
                                </div>
                            </div>

                            <div class="form-group" style="margin-top: 24px;">
                                <label class="form-label">Select Protocols to Scan</label>
                                <div class="protocol-grid">
                                    <div class="protocol-card selected" onclick="toggleProtocol(this)">
                                        <input type="checkbox" name="protocols" value="modbus" checked>
                                        <div class="protocol-icon">
                                            <i class="fas fa-microchip"></i>
                                        </div>
                                        <div class="protocol-name">Modbus</div>
                                        <div class="protocol-port">Port 502</div>
                                    </div>
                                    <div class="protocol-card selected" onclick="toggleProtocol(this)">
                                        <input type="checkbox" name="protocols" value="dnp3" checked>
                                        <div class="protocol-icon">
                                            <i class="fas fa-broadcast-tower"></i>
                                        </div>
                                        <div class="protocol-name">DNP3</div>
                                        <div class="protocol-port">Port 20000</div>
                                    </div>
                                    <div class="protocol-card" onclick="toggleProtocol(this)">
                                        <input type="checkbox" name="protocols" value="ethernet_ip">
                                        <div class="protocol-icon">
                                            <i class="fas fa-ethernet"></i>
                                        </div>
                                        <div class="protocol-name">EtherNet/IP</div>
                                        <div class="protocol-port">Port 44818</div>
                                    </div>
                                    <div class="protocol-card" onclick="toggleProtocol(this)">
                                        <input type="checkbox" name="protocols" value="bacnet">
                                        <div class="protocol-icon">
                                            <i class="fas fa-building"></i>
                                        </div>
                                        <div class="protocol-name">BACnet</div>
                                        <div class="protocol-port">Port 47808</div>
                                    </div>
                                    <div class="protocol-card" onclick="toggleProtocol(this)">
                                        <input type="checkbox" name="protocols" value="s7">
                                        <div class="protocol-icon">
                                            <i class="fas fa-industry"></i>
                                        </div>
                                        <div class="protocol-name">S7 (Siemens)</div>
                                        <div class="protocol-port">Port 102</div>
                                    </div>
                                    <div class="protocol-card" onclick="toggleProtocol(this)">
                                        <input type="checkbox" name="protocols" value="snmp">
                                        <div class="protocol-icon">
                                            <i class="fas fa-network-wired"></i>
                                        </div>
                                        <div class="protocol-name">SNMP</div>
                                        <div class="protocol-port">Port 161</div>
                                    </div>
                                </div>
                            </div>

                            <div style="display: flex; gap: 12px; margin-top: 24px;">
                                <button type="submit" class="btn btn-primary" style="flex: 1;">
                                    <i class="fas fa-play"></i> Start Scan
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="resetForm()">
                                    <i class="fas fa-redo"></i> Reset
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Scan Progress -->
                    <div class="scan-progress" id="scanProgress">
                        <div class="progress-header">
                            <h3 class="progress-title">
                                <div class="scanning-animation">
                                    <span>Scanning Network</span>
                                    <div class="scanning-dots">
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                    </div>
                                </div>
                            </h3>
                            <button class="btn btn-danger" onclick="stopScan()">
                                <i class="fas fa-stop"></i> Stop Scan
                            </button>
                        </div>
                        <div class="scan-mode-indicator" id="scanModeIndicator" style="display: none;">
                            <i class="fas fa-wifi"></i>
                            <span>Passive Monitoring Active</span>
                            <div class="passive-stats">
                                <span>Packets: <strong id="passivePackets">0</strong></span>
                                <span>Hosts: <strong id="passiveHosts">0</strong></span>
                            </div>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="progressBar"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 14px; color: var(--text-secondary);">
                            <span id="progressText">0%</span>
                            <span id="progressTime">Elapsed: 0:00</span>
                        </div>

                        <div class="progress-stats">
                            <div class="progress-stat">
                                <div class="progress-stat-value" id="devicesFound">0</div>
                                <div class="progress-stat-label">Devices Found</div>
                            </div>
                            <div class="progress-stat">
                                <div class="progress-stat-value" id="ipsScanned">0</div>
                                <div class="progress-stat-label">IPs Scanned</div>
                            </div>
                            <div class="progress-stat">
                                <div class="progress-stat-value" id="protocolsDetected">0</div>
                                <div class="progress-stat-label">Protocols Detected</div>
                            </div>
                            <div class="progress-stat">
                                <div class="progress-stat-value" id="errorsCount">0</div>
                                <div class="progress-stat-label">Errors</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Results Tab -->
                <div id="resultsTab" class="tab-content">
                    <div class="results-section">
                        <div class="results-header">
                            <h2 class="results-title">Discovered Devices</h2>
                            <div class="results-actions">
                                <button class="btn btn-secondary">
                                    <i class="fas fa-filter"></i> Filter
                                </button>
                                <button class="btn btn-primary" onclick="addAllDevicesToInventory()">
                                    <i class="fas fa-plus"></i> Add All to Inventory
                                </button>
                            </div>
                        </div>

                        <div class="device-grid" id="discoveredDevices">
                            <!-- Empty state -->
                            <div class="empty-state" style="grid-column: 1 / -1;">
                                <i class="fas fa-search"></i>
                                <div class="empty-state-title">No Recent Results</div>
                                <div class="empty-state-text">Run a network scan to discover devices</div>
                                <button class="btn btn-primary" onclick="switchTab('scan')">
                                    <i class="fas fa-radar"></i> Start New Scan
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Scan History Tab -->
                <div id="historyTab" class="tab-content">
                    <div class="history-table">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Scan Date</th>
                                        <th>Type</th>
                                        <th>Target</th>
                                        <th>Duration</th>
                                        <th>Devices Found</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="scanHistoryBody">
                                    <tr>
                                        <td colspan="7" style="text-align: center; padding: 40px; color: var(--text-tertiary);">
                                            <i class="fas fa-history" style="font-size: 32px; opacity: 0.3; margin-bottom: 12px; display: block;"></i>
                                            No scan history available
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Include User Profile Component -->
    <script src="/static/js/user-profile.js"></script>
    <!-- Include WebSocket client -->
    <script src="/static/js/websocket.js"></script>
    <!-- Include Discovery page JavaScript -->
    <script src="/static/js/discovery.js"></script>
    <!-- Include Discovery Detail page JavaScript -->
    <script src="/static/js/discovery-detail-modal.js"></script>

    <script>
        // Initialize user profile
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize user profile component
            const profileContainer = document.getElementById('userProfileContainer');
            if (profileContainer && window.UserProfile) {
                profileContainer.innerHTML = window.UserProfile.createHTML();
                window.UserProfile.init();
            }
        });

        // Protocol selection toggle
        function toggleProtocol(card) {
            card.classList.toggle('selected');
            const checkbox = card.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
        }
        
        // Handle scan mode change
        function handleScanModeChange() {
            const scanMode = document.getElementById('scanMode').value;
            const interfaceGroup = document.querySelector('.network-interface-group');
            
            if (scanMode === 'passive' || scanMode === 'hybrid') {
                // Show network interface selector
                if (!interfaceGroup) {
                    createInterfaceSelector();
                } else {
                    interfaceGroup.classList.add('visible');
                }
                
                // Update scan button text
                const scanButton = document.querySelector('button[type="submit"]');
                if (scanMode === 'passive') {
                    scanButton.innerHTML = '<i class="fas fa-wifi"></i> Start Monitoring';
                } else {
                    scanButton.innerHTML = '<i class="fas fa-play"></i> Start Hybrid Scan';
                }
                
                // Show passive indicator during scan
                if (currentScan) {
                    document.getElementById('scanModeIndicator').style.display = 'flex';
                }
            } else {
                // Hide interface selector
                if (interfaceGroup) {
                    interfaceGroup.classList.remove('visible');
                }
                
                // Reset scan button text
                const scanButton = document.querySelector('button[type="submit"]');
                scanButton.innerHTML = '<i class="fas fa-play"></i> Start Scan';
                
                // Hide passive indicator
                document.getElementById('scanModeIndicator').style.display = 'none';
            }
        }

        // Create network interface selector
        function createInterfaceSelector() {
            const formElement = document.getElementById('scanForm');
            const protocolSection = document.querySelector('.form-group:last-child');
            
            const interfaceHTML = `
                <div class="network-interface-group visible">
                    <label class="form-label">
                        <i class="fas fa-ethernet"></i> Network Interface for Passive Monitoring
                    </label>
                    <div class="interface-list">
                        <div class="interface-item selected" onclick="selectInterface(this, 'eth0')">
                            <div class="interface-name">eth0</div>
                            <div class="interface-ip">Primary Network</div>
                        </div>
                        <div class="interface-item" onclick="selectInterface(this, 'eth1')">
                            <div class="interface-name">eth1</div>
                            <div class="interface-ip">Secondary Network</div>
                        </div>
                        <div class="interface-item" onclick="selectInterface(this, 'any')">
                            <div class="interface-name">any</div>
                            <div class="interface-ip">All Interfaces</div>
                        </div>
                    </div>
                    <input type="hidden" id="networkInterface" name="networkInterface" value="eth0">
                </div>
            `;
            
            // Insert after protocols section
            protocolSection.insertAdjacentHTML('afterend', interfaceHTML);
        }

        // Select network interface
        function selectInterface(element, interfaceName) {
            // Remove selected class from all items
            document.querySelectorAll('.interface-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Add selected class to clicked item
            element.classList.add('selected');
            
            // Update hidden input
            document.getElementById('networkInterface').value = interfaceName;
        }

        // Update passive monitoring stats
        function updatePassiveStats(packets, hosts) {
            const packetsElement = document.getElementById('passivePackets');
            const hostsElement = document.getElementById('passiveHosts');
            
            if (packetsElement) packetsElement.textContent = packets;
            if (hostsElement) hostsElement.textContent = hosts;
        }

        // Add protocol enhancement indicators
        document.addEventListener('DOMContentLoaded', function() {
            const protocolEnhancements = {
                'modbus': 'Deep packet inspection for function codes',
                'dnp3': 'Outstation identification & classification',
                'ethernet_ip': 'CIP object detection & vendor ID',
                'bacnet': 'Device object property discovery',
                's7': 'PLC model & firmware detection',
                'snmp': 'MIB-based device profiling'
            };
            
            // Add enhancement badges to existing protocol cards
            document.querySelectorAll('.protocol-card').forEach(card => {
                const checkbox = card.querySelector('input[type="checkbox"]');
                if (checkbox && protocolEnhancements[checkbox.value]) {
                    const enhancement = document.createElement('div');
                    enhancement.className = 'protocol-enhancement';
                    enhancement.innerHTML = `
                        <i class="fas fa-bolt"></i>
                        <span>${protocolEnhancements[checkbox.value]}</span>
                    `;
                    card.appendChild(enhancement);
                }
            });
        });
    </script>
</body>
</html>